<style>
  main {
    margin-top: 0;
  }
  
  article .dropdown .wrap > h2,
  article .news .wrap > h2 {
    color: <%= locals.setting.pointColor %>;
  }
</style>
<!-- Slick Start -->
<script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js" defer></script>
<script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js" defer></script>
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js" defer></script>
<script src="/theme/5il7fg/javascripts/indexSlick.js" defer></script>
<!-- Slick End -->
<article>
  <section class="top">
    <div class="slider">
      <% locals.banners.forEach(b => { %>
        <% if (b.position === 'custom' && b.status === 1) { %>
        <div class="slide" style="background-image: url('<%= locals.s3Host %>/banner/<%= b.image %>');"></div>
        <% } %>
      <% }) %>
    </div>
    <div class="search">
      <div class="wrap">
        <div class="title">제휴점 검색</div>
        <div class="select">
          <div class="city">
            <div class="label">광역시/도</div>
            <div class="text">서울</div>
          </div>
          <div class="province">
            <div class="label">지역</div>
            <div class="text"></div>
          </div>
        </div>
        <div class="button">
          <img src="/theme/5il7fg/assets/search.svg">
        </div>
        <div class="box">
          <div class="cities">
            <% cities.forEach(c => { %>
            <div class="city<% if (c.id === 1) { %> citySelected<% } %>" cityId="<%= c.id %>"><%= c.title %></div>
            <% }) %>
          </div>
          <div class="provinces">
          </div>
        </div>
      </div>
    </div>
  </section>
  <section class="type">
    <div class="wrap">
      <div class="items">
        <a href="/location?filter=swedish" class="item">
          <div class="image"><img src="/assets/emptyRect.png" style="background-image: url('https://serve-swedish.s3.ap-northeast-2.amazonaws.com/assets/1641152038702-o6keh3pzr4.jpg');"></div>
          <div class="title">스웨디시&로미로미</div>
        </a>
        <a href="/location?filter=sleep" class="item">
          <div class="image"><img src="/assets/emptyRect.png" style="background-image: url('https://serve-swedish.s3.ap-northeast-2.amazonaws.com/assets/1641152038543-z0r2o03kgh.jpg');"></div>
          <div class="title">수면가능</div>
        </a>
        <a href="/location?filter=dry" class="item">
          <div class="image"><img src="/assets/emptyRect.png" style="background-image: url('https://serve-swedish.s3.ap-northeast-2.amazonaws.com/assets/1641152395571-oxmhcr26cz.jpg');"></div>
          <div class="title">타이&건식</div>
        </a>
        <a href="/location?filter=aroma" class="item">
          <div class="image"><img src="/assets/emptyRect.png" style="background-image: url('https://serve-swedish.s3.ap-northeast-2.amazonaws.com/assets/1641152287046-920wml8gz3.jpg');"></div>
          <div class="title">아로마&림프관리</div>
        </a>
        <a href="/location?filter=korea" class="item">
          <div class="image"><img src="/assets/emptyRect.png" style="background-image: url('https://serve-swedish.s3.ap-northeast-2.amazonaws.com/assets/1641152038702-qndsb3s6lza.jpg');"></div>
          <div class="title">한국</div>
        </a>
        <a href="/location?filter=china" class="item">
          <div class="image"><img src="/assets/emptyRect.png" style="background-image: url('https://serve-swedish.s3.ap-northeast-2.amazonaws.com/assets/1641152038694-mpaic59qnti.jpg');"></div>
          <div class="title">중국</div>
        </a>
        <a href="/location?filter=thai" class="item">
          <div class="image"><img src="/assets/emptyRect.png" style="background-image: url('https://serve-swedish.s3.ap-northeast-2.amazonaws.com/assets/1641152038693-v5nerq9c6jp.jpg');"></div>
          <div class="title">태국</div>
        </a>
        <a href="/location?filter=waxing" class="item">
          <div class="image"><img src="/assets/emptyRect.png" style="background-image: url('https://serve-swedish.s3.ap-northeast-2.amazonaws.com/assets/1641152038680-3fl1yf41b21.jpg');"></div>
          <div class="title">왁싱</div>
        </a>
        <div class="line"></div>
        <a href="/location?filter=hotel" class="item">
          <div class="image"><img src="/assets/emptyRect.png" style="background-image: url('https://serve-swedish.s3.ap-northeast-2.amazonaws.com/assets/1641152038679-ul4lqa9gaw.jpg');"></div>
          <div class="title">호텔식/스파/사우나</div>
        </a>
        <a href="/location?filter=home" class="item">
          <div class="image"><img src="/assets/emptyRect.png" style="background-image: url('https://serve-swedish.s3.ap-northeast-2.amazonaws.com/assets/1641152659741-enakuuk844a.jpg');"></div>
          <div class="title">홈케어</div>
        </a>
        <a href="/location?filter=talk" class="item">
          <div class="image"><img src="/assets/emptyRect.png" style="background-image: url('https://serve-swedish.s3.ap-northeast-2.amazonaws.com/assets/1641152805385-0mom4a6058u.jpg');"></div>
          <div class="title">Talk테라피</div>
        </a>
        <a href="/location?filter=road" class="item">
          <div class="image"><img src="/assets/emptyRect.png" style="background-image: url('https://serve-swedish.s3.ap-northeast-2.amazonaws.com/assets/1641152038544-bp1twz6t64a.jpg');"></div>
          <div class="title">로드샵</div>
        </a>
        <a href="/location?filter=one" class="item">
          <div class="image"><img src="/assets/emptyRect.png" style="background-image: url('https://serve-swedish.s3.ap-northeast-2.amazonaws.com/assets/1641152592709-mwng2xv22yl.jpg');"></div>
          <div class="title">1인샵다인샵</div>
        </a>
        <a href="/location?filter=couple" class="item">
          <div class="image"><img src="/assets/emptyRect.png" style="background-image: url('https://serve-swedish.s3.ap-northeast-2.amazonaws.com/assets/1641152038663-aj5eapy63hi.jpg');"></div>
          <div class="title">커플전문</div>
        </a>
        <a href="/location?filter=women" class="item">
          <div class="image"><img src="/assets/emptyRect.png" style="background-image: url('https://serve-swedish.s3.ap-northeast-2.amazonaws.com/assets/1641152038662-gkoc9nidejh.jpg');"></div>
          <div class="title">여성전용</div>
        </a>
        <a href="/location?filter=men" class="item">
          <div class="image"><img src="/assets/emptyRect.png" style="background-image: url('https://serve-swedish.s3.ap-northeast-2.amazonaws.com/assets/1641152038662-buczmeeyl0e.jpg');"></div>
          <div class="title">남성전용</div>
        </a>
      </div>
    </div>
  </section>
  <%- include('../offline/stores') %>
  <% if (boards[0]) { %>
  <section class="dropdown">
    <div class="wrap">
      <h2><%= boards[0].title %></h2>
      <div class="items">
        <% boards[0].articles.reverse().forEach(a => { %>
          <div class="item">
            <div class="title">
              <h3><%= a.title %></h3>
              <div class="more">펼치기</div>
            </div>
            <div class="content"><%- a.content %></div>
          </div>
        <% }) %>
      </div>
    </div>
  </section>
  <% } %>
  <% if (boards[1]) { %>
  <section class="dropdown">
    <div class="wrap">
      <h2><%= boards[1].title %></h2>
      <div class="items">
        <% boards[1].articles.reverse().forEach(a => { %>
          <div class="item">
            <div class="title">
              <h3><%= a.title %></h3>
              <div class="more">펼치기</div>
            </div>
            <div class="content"><%- a.content %></div>
          </div>
        <% }) %>
      </div>
    </div>
  </section>
  <% } %>
  <% if (boards[2]) { %>
  <section class="news">
    <div class="wrap">
      <h2><%= boards[2].title %></h2>
      <div class="items">
        <% boards[2].articles.forEach(a => { %>
        <a href="/<%= boards[2].slug %>/<%= a.id %>" class="item">
          <div class="image">
            <% if (a.images) { %>
            <img src="/assets/empty.png" style="background-image: url('<%= s3Host %>/article/<%= a.images[0].image %>');">
            <% } %>
          </div>
          <div class="info">
            <div class="title"><%= a.title %></div>
            <div class="content"><%= a.content.replace(/<[^>]*>/ig, '') %></div>
          </div>
        </a>
        <% }) %>
      </div>
    </div>
  </section>
  <% } %>
  <% if (boards[3]) { %>
  <section class="dropdown">
    <div class="wrap">
      <h2><%= boards[3].title %></h2>
      <div class="items">
        <% boards[3].articles.reverse().forEach(a => { %>
          <div class="item">
            <div class="title">
              <h3><%= a.title %></h3>
              <div class="more">펼치기</div>
            </div>
            <div class="content"><%- a.content %></div>
          </div>
        <% }) %>
      </div>
    </div>
  </section>
  <% } %>
  <% if (boards[4]) { %>
  <section class="dropdown">
    <div class="wrap">
      <h2><%= boards[4].title %></h2>
      <div class="items">
        <% boards[4].articles.reverse().forEach(a => { %>
          <div class="item">
            <div class="title">
              <h3><%= a.title %></h3>
              <div class="more">펼치기</div>
            </div>
            <div class="content"><%- a.content %></div>
          </div>
        <% }) %>
      </div>
    </div>
  </section>
  <% } %>
  <% if (boards[5]) { %>
  <section class="dropdown">
    <div class="wrap">
      <h2><%= boards[5].title %></h2>
      <div class="items">
        <% boards[5].articles.reverse().forEach(a => { %>
          <div class="item">
            <div class="title">
              <h3><%= a.title %></h3>
              <div class="more">펼치기</div>
            </div>
            <div class="content"><%- a.content %></div>
          </div>
        <% }) %>
      </div>
    </div>
  </section>
  <% } %>
  <% if (boards[6]) { %>
  <section class="dropdown">
    <div class="wrap">
      <h2><%= boards[6].title %></h2>
      <div class="items">
        <% boards[6].articles.reverse().forEach(a => { %>
          <div class="item">
            <div class="title">
              <h3><%= a.title %></h3>
              <div class="more">펼치기</div>
            </div>
            <div class="content"><%- a.content %></div>
          </div>
        <% }) %>
      </div>
    </div>
  </section>
  <% } %>
</article>
<script>
  const dropdownItem = document.querySelectorAll('.dropdown .item');
  dropdownItem.forEach(item => {
    item.addEventListener('click', () => {
      const content = item.querySelector('.content');
      content.classList.toggle('active');
    });
  });
</script>
<script>
  const searchCity = document.querySelector('.search .city');
  const searchProvince = document.querySelector('.search .province');
  const provinces = document.querySelector('.provinces');
  const searchBtn = document.querySelector('.search .button');
  const box = document.querySelector('.box');

  searchBtn.addEventListener('click', () => {
    let url = null;
    if (searchCity.id && searchProvince.id) {
      url = `/location?city=${searchCity.id}&province=${searchProvince.id}`;
    } else if (searchCity.id) {
      url = `/location?city=${searchCity.id}`;
    }
    window.location.href = url;
  });

  searchCity.addEventListener('click', () => {
    box.classList.toggle('active');
  });
  searchProvince.addEventListener('click', () => {
    box.classList.toggle('active');
  });

  const getProvinces = () => {
    return new Promise((resolve, reject) => {
      const xhr = new XMLHttpRequest();
      xhr.open('GET', '/api/offline/provinces');
      xhr.onload = () => {
        const result = JSON.parse(xhr.responseText);
        resolve(result);
      };
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.send();
    });
  };

  const rewirteProvinces = (selectProvinces) => {
    let line = '';
    selectProvinces.forEach(p => {
      line += `<div class="province" provinceId="${p.id}">${p.title}</div>`;
    });
    provinces.innerHTML = line;
  };

  (async () => {
    const cityGrid = document.querySelectorAll('.cities .city');
    cityGrid.forEach(c => {
      c.addEventListener('click', () => {
        searchCity.id = c.attributes.cityId.value;
        searchProvince.id = '';
        searchCity.querySelector('.text').innerHTML = c.innerHTML;
        searchProvince.querySelector('.text').innerHTML = '';
        cityGrid.forEach(c => c.className = 'city');
        c.className = 'city citySelected';
        const selectProvinces = provinces.filter(p => p.offlineProvince_offlineCity_ID === Number(c.attributes.cityId.value));
        rewirteProvinces(selectProvinces, c.attributes.cityId.value);
        addEvent();
      });
    });
    const addEvent = () => {
      const provinceGrid = document.querySelectorAll('.provinces .province');
      provinceGrid.forEach(p => {
        p.addEventListener('click', () => {
          searchProvince.id = p.attributes.provinceId.value;
          searchProvince.querySelector('.text').innerHTML = p.innerHTML;
          provinceGrid.forEach(p => p.className = 'province');
          p.className = 'province provinceSelected';
          box.classList.toggle('active');
        });
      });
    };

    const provinces = await getProvinces();
    const selectCity = document.querySelector('.citySelected');
    const selectProvinces = provinces.filter(p => p.offlineProvince_offlineCity_ID === Number(selectCity.attributes.cityId.value));
    rewirteProvinces(selectProvinces, null);
    searchCity.id = 1;
    addEvent();
  })();
</script>